{% extends "base.html" %}

{% block title %}ØªÙ‚Ø±ÙŠØ± Ù…Ù‡Ø§Ø±Ø§Øª Ø§Ù„Ù…ØªØ¯Ø±Ø¨ - {{ trainee.trainee_name }}{% endblock %}

{% block content %}
<div class="container-fluid mt-4">
  
  <!-- Ø±Ø£Ø³ Ø§Ù„ØªÙ‚Ø±ÙŠØ± -->
  <div class="row mb-4">
    <div class="col-md-12">
      <div class="card shadow-sm border-top-primary">
        <div class="card-body">
          <div class="row align-items-center">
            <div class="col-md-8">
              <h2 class="mb-0">ğŸ“Š ØªÙ‚Ø±ÙŠØ± Ø´Ø§Ù…Ù„ Ù„Ø³Ø¬Ù„ Ø§Ù„Ù…Ù‡Ø§Ø±Ø§Øª Ø§Ù„Ø´Ø®ØµÙŠØ©</h2>
              <p class="text-muted mb-0">{{ trainee.trainee_name }} - {{ trainee.trainee_no }}</p>
            </div>
            <div class="col-md-4 text-end">
              <button class="btn btn-primary" onclick="window.print()">
                <i class="fas fa-print"></i> Ø·Ø¨Ø§Ø¹Ø©
              </button>
              <button class="btn btn-success" onclick="exportToPDF()">
                <i class="fas fa-file-pdf"></i> ØªØ­Ù…ÙŠÙ„ PDF
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ØªØ¯Ø±Ø¨ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© -->
  <div class="row mb-4">
    <div class="col-md-3">
      <div class="card text-center border-0 shadow-sm">
        <div class="card-body">
          <h6 class="text-muted mb-2">Ø±Ù‚Ù… Ø§Ù„Ù…ØªØ¯Ø±Ø¨</h6>
          <h3 class="card-title">{{ trainee.trainee_no }}</h3>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card text-center border-0 shadow-sm">
        <div class="card-body">
          <h6 class="text-muted mb-2">Ø¹Ø¯Ø¯ Ø§Ù„Ø¯ÙˆØ±Ø§Øª</h6>
          <h3 class="card-title text-primary">{{ trainee.completed_courses }}</h3>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card text-center border-0 shadow-sm">
        <div class="card-body">
          <h6 class="text-muted mb-2">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø³Ø§Ø¹Ø§Øª</h6>
          <h3 class="card-title text-success">{{ trainee.total_hours }}</h3>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card text-center border-0 shadow-sm">
        <div class="card-body">
          <h6 class="text-muted mb-2">Ø§Ù„Ø´Ù‡Ø§Ø¯Ø§Øª Ø§Ù„ØµØ§Ø¯Ø±Ø©</h6>
          <h3 class="card-title text-info">{{ trainee.total_certificates }}/{{ trainee.completed_courses }}</h3>
        </div>
      </div>
    </div>
  </div>

  <!-- ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø¯ÙˆØ±Ø§Øª Ø§Ù„ØªÙØµÙŠÙ„ÙŠ -->
  <div class="card shadow-sm mb-4">
    <div class="card-header bg-gradient-primary text-white">
      <h5 class="mb-0"><i class="fas fa-book"></i> Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¯ÙˆØ±Ø§Øª Ø§Ù„ØªØ¯Ø±ÙŠØ¨ÙŠØ©</h5>
    </div>
    <div class="card-body p-0">
      <div class="table-responsive">
        <table class="table table-hover table-striped mb-0">
          <thead class="table-light">
            <tr>
              <th class="text-center" style="width: 5%">#</th>
              <th style="width: 30%">Ø§Ø³Ù… Ø§Ù„Ø¯ÙˆØ±Ø©</th>
              <th class="text-center" style="width: 12%">Ø§Ù„Ø³Ø§Ø¹Ø§Øª</th>
              <th class="text-center" style="width: 18%">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©</th>
              <th class="text-center" style="width: 18%">ØªØ§Ø±ÙŠØ® Ø§Ù„Ù†Ù‡Ø§ÙŠØ©</th>
              <th style="width: 15%">Ø§Ù„Ø¬Ù‡Ø© Ø§Ù„Ù…Ù†ÙØ°Ø©</th>
              <th class="text-center" style="width: 12%">Ø§Ù„Ø­Ø§Ù„Ø©</th>
            </tr>
          </thead>
          <tbody>
            {% for course in trainee.courses %}
            <tr>
              <td class="text-center">{{ loop.index }}</td>
              <td>
                <strong>{{ course.course_title }}</strong>
                {% if course.description %}
                <br><small class="text-muted">{{ course.description[:80] }}{% if course.description|length > 80 %}...{% endif %}</small>
                {% endif %}
              </td>
              <td class="text-center">
                <span class="badge bg-success">{{ course.hours }}</span>
              </td>
              <td class="text-center">
                <small>
                  {% if course.start_date %}
                    {% set start_str = course.start_date.strftime('%d/%m/%Y') if course.start_date.strftime is defined else course.start_date %}
                    {{ start_str }}
                  {% else %}-{% endif %}
                </small>
              </td>
              <td class="text-center">
                <small>
                  {% if course.end_date %}
                    {% set end_str = course.end_date.strftime('%d/%m/%Y') if course.end_date.strftime is defined else course.end_date %}
                    {{ end_str }}
                  {% else %}-{% endif %}
                </small>
              </td>
              <td>
                <small>{{ course.provider or '-' }}</small>
              </td>
              <td class="text-center">
                {% if course.certificate_code %}
                  <span class="badge bg-success">âœ“ Ø´Ù‡Ø§Ø¯Ø©</span>
                {% else %}
                  <span class="badge bg-warning">â§— Ø¨Ø¯ÙˆÙ† Ø´Ù‡Ø§Ø¯Ø©</span>
                {% endif %}
              </td>
            </tr>
            {% endfor %}
          </tbody>
          <tfoot class="table-light">
            <tr style="font-weight: bold;">
              <td colspan="2" class="text-end">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙƒÙ„ÙŠ:</td>
              <td class="text-center">
                <span class="badge bg-success" style="font-size: 1rem;">{{ trainee.total_hours }} Ø³Ø§Ø¹Ø©</span>
              </td>
              <td colspan="4"></td>
            </tr>
          </tfoot>
        </table>
      </div>
    </div>
  </div>

  <!-- Ù…Ù„Ø®Øµ Ø¥Ø­ØµØ§Ø¦ÙŠ -->
  <div class="row mb-4">
    <div class="col-md-6">
      <div class="card shadow-sm border-left-success">
        <div class="card-header bg-light">
          <h6 class="mb-0"><i class="fas fa-chart-pie text-success"></i> Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„ØªØ¯Ø±ÙŠØ¨</h6>
        </div>
        <div class="card-body">
          <div class="row mb-3">
            <div class="col-6">
              <small class="text-muted">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¯ÙˆØ±Ø§Øª:</small>
              <p class="h5 mb-0">{{ trainee.completed_courses }}</p>
            </div>
            <div class="col-6">
              <small class="text-muted">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø³Ø§Ø¹Ø§Øª:</small>
              <p class="h5 mb-0">{{ trainee.total_hours }} Ø³Ø§Ø¹Ø©</p>
            </div>
          </div>
          <div class="row mb-3">
            <div class="col-6">
              <small class="text-muted">Ø§Ù„Ø´Ù‡Ø§Ø¯Ø§Øª Ø§Ù„ØµØ§Ø¯Ø±Ø©:</small>
              <p class="h5 mb-0">{{ trainee.total_certificates }}</p>
            </div>
            <div class="col-6">
              <small class="text-muted">Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø¥ÙƒÙ…Ø§Ù„:</small>
              <p class="h5 mb-0">
                {% if trainee.completed_courses > 0 %}
                  {{ ((trainee.total_certificates / trainee.completed_courses) * 100)|round(0)|int }}%
                {% else %}
                  0%
                {% endif %}
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="col-md-6">
      <div class="card shadow-sm border-left-info">
        <div class="card-header bg-light">
          <h6 class="mb-0"><i class="fas fa-info-circle text-info"></i> Ù…Ù„Ø§Ø­Ø¸Ø§Øª</h6>
        </div>
        <div class="card-body">
          <p class="mb-2">
            <strong>Ø§Ù„Ø­Ø§Ù„Ø©:</strong> 
            {% if trainee.total_certificates == trainee.completed_courses %}
              <span class="badge bg-success">Ù…ØªÙ‚Ø¯Ù… - Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø´Ù‡Ø§Ø¯Ø§Øª ØµØ§Ø¯Ø±Ø©</span>
            {% elif trainee.total_certificates > 0 %}
              <span class="badge bg-warning">Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© - Ø¨Ø¹Ø¶ Ø§Ù„Ø´Ù‡Ø§Ø¯Ø§Øª ØµØ§Ø¯Ø±Ø©</span>
            {% else %}
              <span class="badge bg-danger">Ù„Ù… ØªØµØ¯Ø± Ø´Ù‡Ø§Ø¯Ø§Øª Ø¨Ø¹Ø¯</span>
            {% endif %}
          </p>
          <p class="text-muted small">
            Ù‡Ø°Ø§ Ø§Ù„ØªÙ‚Ø±ÙŠØ± ÙŠØ¹ÙƒØ³ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¯ÙˆØ±Ø§Øª Ø§Ù„ØªØ¯Ø±ÙŠØ¨ÙŠØ© ÙˆØ§Ù„Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ù…Ø³Ø¬Ù„Ø© Ù„Ù„Ù…ØªØ¯Ø±Ø¨ ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù….
          </p>
        </div>
      </div>
    </div>
  </div>

  <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ… -->
  <div class="row mt-4 mb-4">
    <div class="col">
      <a href="/hod/skills-record" class="btn btn-secondary">
        <i class="fas fa-arrow-right"></i> Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø¨Ø­Ø«
      </a>
    </div>
  </div>

</div>

<style>
  .border-top-primary {
    border-top: 4px solid #0f7d89 !important;
  }

  .border-left-primary {
    border-left: 4px solid #0f7d89 !important;
  }

  .border-left-success {
    border-left: 4px solid #2bb9a6 !important;
  }

  .border-left-info {
    border-left: 4px solid #0f7d89 !important;
  }

  .bg-gradient-primary {
    background: linear-gradient(135deg, #0f7d89, #2bb9a6) !important;
  }

  .card {
    border-radius: 8px;
  }

  .table thead th {
    font-weight: 700;
    color: #0f7d89;
    border-bottom: 2px solid #2bb9a6;
  }

  .table tbody tr:hover {
    background-color: #f0f9f9;
  }

  .badge {
    padding: 0.5rem 0.8rem;
    font-weight: 600;
  }

  @media print {
    .btn, form {
      display: none !important;
    }
    .card {
      page-break-inside: avoid;
      border: 1px solid #ddd !important;
      box-shadow: none !important;
    }
    body {
      background: white;
    }
  }
</style>

<script>
  function exportToPDF() {
    const element = document.querySelector('.container-fluid');
    const opt = {
      margin: 10,
      filename: 'ØªÙ‚Ø±ÙŠØ±_{{ trainee.trainee_no }}_{{ trainee.trainee_name }}.pdf',
      image: { type: 'jpeg', quality: 0.98 },
      html2canvas: { scale: 2, useCORS: true },
      jsPDF: { orientation: 'p', unit: 'mm', format: 'a4' }
    };
    
    // ØªØ­Ù…ÙŠÙ„ html2pdf Ù…Ù† CDN
    const script = document.createElement('script');
    script.src = 'https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js';
    script.onload = function() {
      html2pdf().set(opt).from(element).save();
    };
    document.head.appendChild(script);
  }
</script>

{% endblock %}
